ACTOR SpiderMadnessmind : SpiderMastermind2 {
	SeeSound "madness/sight"
  PainSound "spider/pain"
  DeathSound "madness/demdth"
  ActiveSound "madness/active"
  Obituary "%o became another victim of the SpiderMadnessmind."
	var int user_attack;
	
	States {
		SpawnLoop:
			CONQ A 0
			CONQ A 0 A_SpawnItemEx("SkullCube", 0, 0, 32, 0, 0, 0, 0, SXF_SETMASTER)
			CONQ A 0 A_SpawnItemEx("SkullCube", 0, 0, 32, 0, 0, 0, 120, SXF_SETMASTER)
			CONQ A 0 A_SpawnItemEx("SkullCube", 0, 0, 32, 0, 0, 0, 240, SXF_SETMASTER)
			Goto Idle
			
		Idle:
			CONQ AB 10 A_Look
			Loop
			
		See:
			CONQ A 3 A_Metal
			CONQ ABB 3 A_Chase
			CONQ C 3 A_Metal
			CONQ CDD 3 A_Chase
			CONQ E 3 A_Metal
			CONQ EFF 3 A_Chase
			Loop
			
		Missile:
			TNT1 A 0 A_JumpIf(user_attack < 1 && health < 2000, "Countdown")
			CONQ A 20 Bright A_FaceTarget
			TNT1 A 0 A_PlaySound("spider/attack", CHAN_AUTO)
			CONQ G 4 Bright A_CustomMissile("ShotgunnerTracer", 48, 0, frandom(-16, 16), 1)
			TNT1 A 0 Bright A_CustomMissile("ShotgunnerTracer", 48, 0, frandom(-16, 16), 1)
			TNT1 A 0 Bright A_CustomMissile("ShotgunnerTracer", 48, 0, frandom(-16, 16), 1)
			TNT1 A 0 A_PlaySound("spider/attack", CHAN_AUTO)
			CONQ H 4 Bright A_CustomMissile("ShotgunnerTracer", 48, 0, frandom(-16, 16), 1)
			TNT1 A 0 Bright A_CustomMissile("ShotgunnerTracer", 48, 0, frandom(-16, 16), 1)
			TNT1 A 0 Bright A_CustomMissile("ShotgunnerTracer", 48, 0, frandom(-16, 16), 1)
			TNT1 A 0 A_SetUserVar("user_attack", user_attack - 1)
			CONQ H 1 Bright A_SpidRefire
			Goto Missile+3
			
		Countdown:
			CONQ G 0 Bright A_PlaySound("madness/counts")
			CONQ G 10 Bright A_FaceTarget
			TNT1 A 0 A_ChangeFlag("NOPAIN", true)
			TNT1 A 0 A_VileTarget("MadnessCountdown")
			TNT1 A 0 A_SetUserVar("user_attack", 10)
			CONQ GGGGGGGGGGGGGGGGGGG 5 Bright A_FaceTarget
			TNT1 A 0 A_ChangeFlag("NOPAIN", false)
			Goto See
			
		Pain:
			CONQ I 3
			CONQ I 3 A_Pain
			Goto See
			
		Death:
			CONQ J 0 A_KillChildren
			CONQ J 20 A_Scream
			CONQ K 10 A_NoBlocking
			CONQ LM 10
			TNT1 A 0 A_Explode(random(1, 4) * 20, 128)
			TNT1 A 0 A_SpawnItemEx("MadnessMiniNuke",  80,   0,0,0,0,0,0,SXF_NOCHECKPOSITION)
			TNT1 A 0 A_SpawnItemEx("MadnessMiniNuke", -80,   0,0,0,0,0,0,SXF_NOCHECKPOSITION)
			TNT1 A 0 A_SpawnItemEx("MadnessMiniNuke",   0,  80,0,0,0,0,0,SXF_NOCHECKPOSITION)
			TNT1 A 0 A_SpawnItemEx("MadnessMiniNuke",   0, -80,0,0,0,0,0,SXF_NOCHECKPOSITION)
			TNT1 A 0 A_SpawnItemEx("MadnessMiniNuke",  64,  64,0,0,0,0,0,SXF_NOCHECKPOSITION)
			TNT1 A 0 A_SpawnItemEx("MadnessMiniNuke", -64,  64,0,0,0,0,0,SXF_NOCHECKPOSITION)
			TNT1 A 0 A_SpawnItemEx("MadnessMiniNuke", -64, -64,0,0,0,0,0,SXF_NOCHECKPOSITION)
			TNT1 A 0 A_SpawnItemEx("MadnessMiniNuke",  64, -64,0,0,0,0,0,SXF_NOCHECKPOSITION)
			TNT1 A 0 A_PlaySound("world/barrelx")
			CONQ NOPQR 10
			CONQ S 30
			CONQ S -1 A_BossDeath
			Stop
  }
}

ACTOR SkullCube : YYTMonster {
  Radius 32
  Height 64
  Mass 150
  Health 800
  PainChance 255
  DeathSound "skull/death"
  Species "Spider"
  -SOLID
  -COUNTKILL
  +NOGRAVITY
  +FLOAT
  +DONTFALL
  +NOBLOOD
  +THRUSPECIES
  +NOTARGETSWITCH
  var int user_angle;

  States {
		Spawn:
			CUBE A 0 NoDelay A_SetUserVar("user_angle", angle)
			Goto Idle
			
		Idle:
			CUBE A 1 Bright A_Warp(AAPTR_MASTER, 128, 0, 32, user_angle, WARPF_ABSOLUTEANGLE|WARPF_NOCHECKPOSITION|WARPF_INTERPOLATE)
			TNT1 A 0 A_SetUserVar("user_angle", user_angle + 4)
			TNT1 A 0 A_Chase
			CUBE A 1 Bright A_Warp(AAPTR_MASTER, 128, 0, 32, user_angle, WARPF_ABSOLUTEANGLE|WARPF_NOCHECKPOSITION|WARPF_INTERPOLATE)
			TNT1 A 0 A_SetUserVar("user_angle", user_angle + 4)
			TNT1 A 0 A_Chase
			CUBE A 1 Bright A_Warp(AAPTR_MASTER, 128, 0, 32, user_angle, WARPF_ABSOLUTEANGLE|WARPF_NOCHECKPOSITION|WARPF_INTERPOLATE)
			TNT1 A 0 A_SetUserVar("user_angle", user_angle + 4)
			TNT1 A 0 A_Chase
			CUBE B 1 Bright A_Warp(AAPTR_MASTER, 128, 0, 32, user_angle, WARPF_ABSOLUTEANGLE|WARPF_NOCHECKPOSITION|WARPF_INTERPOLATE)
			TNT1 A 0 A_SetUserVar("user_angle", user_angle + 4)
			TNT1 A 0 A_Chase
			CUBE B 1 Bright A_Warp(AAPTR_MASTER, 128, 0, 32, user_angle, WARPF_ABSOLUTEANGLE|WARPF_NOCHECKPOSITION|WARPF_INTERPOLATE)
			TNT1 A 0 A_SetUserVar("user_angle", user_angle + 4)
			TNT1 A 0 A_Chase
			CUBE B 1 Bright A_Warp(AAPTR_MASTER, 128, 0, 32, user_angle, WARPF_ABSOLUTEANGLE|WARPF_NOCHECKPOSITION|WARPF_INTERPOLATE)
			TNT1 A 0 A_SetUserVar("user_angle", user_angle + 4)
			TNT1 A 0 A_Chase
			CUBE C 1 Bright A_Warp(AAPTR_MASTER, 128, 0, 32, user_angle, WARPF_ABSOLUTEANGLE|WARPF_NOCHECKPOSITION|WARPF_INTERPOLATE)
			TNT1 A 0 A_SetUserVar("user_angle", user_angle + 4)
			TNT1 A 0 A_Chase
			CUBE C 1 Bright A_Warp(AAPTR_MASTER, 128, 0, 32, user_angle, WARPF_ABSOLUTEANGLE|WARPF_NOCHECKPOSITION|WARPF_INTERPOLATE)
			TNT1 C 0 A_SetUserVar("user_angle", user_angle + 4)
			TNT1 A 0 A_Chase
			CUBE C 1 Bright A_Warp(AAPTR_MASTER, 128, 0, 32, user_angle, WARPF_ABSOLUTEANGLE|WARPF_NOCHECKPOSITION|WARPF_INTERPOLATE)
			TNT1 A 0 A_SetUserVar("user_angle", user_angle + 4)
			TNT1 A 0 A_Chase
			Loop
			
		Missile:
			CUBE D 1 Bright A_Warp(AAPTR_MASTER, 128, 0, 32, user_angle, WARPF_ABSOLUTEANGLE|WARPF_NOCHECKPOSITION|WARPF_INTERPOLATE)
			TNT1 A 0 A_SetUserVar("user_angle", user_angle + 4)
			CUBE D 1 Bright A_Warp(AAPTR_MASTER, 128, 0, 32, user_angle, WARPF_ABSOLUTEANGLE|WARPF_NOCHECKPOSITION|WARPF_INTERPOLATE)
			TNT1 A 0 A_SetUserVar("user_angle", user_angle + 4)
			CUBE D 1 Bright A_Warp(AAPTR_MASTER, 128, 0, 32, user_angle, WARPF_ABSOLUTEANGLE|WARPF_NOCHECKPOSITION|WARPF_INTERPOLATE)
			TNT1 A 0 A_SetUserVar("user_angle", user_angle + 4)
			CUBE E 1 Bright A_Warp(AAPTR_MASTER, 128, 0, 32, user_angle, WARPF_ABSOLUTEANGLE|WARPF_NOCHECKPOSITION|WARPF_INTERPOLATE)
			TNT1 A 0 A_SetUserVar("user_angle", user_angle + 4)
			TNT1 A 0 A_CustomMissile("SkullCubeShot",10, 6,0, CMF_AIMOFFSET)
			TNT1 A 0 A_CustomMissile("SkullCubeShot",10,-6,0, CMF_AIMOFFSET)
			CUBE E 1 Bright A_Warp(AAPTR_MASTER, 128, 0, 32, user_angle, WARPF_ABSOLUTEANGLE|WARPF_NOCHECKPOSITION|WARPF_INTERPOLATE)
			TNT1 A 0 A_SetUserVar("user_angle", user_angle + 4)
			CUBE E 1 Bright A_Warp(AAPTR_MASTER, 128, 0, 32, user_angle, WARPF_ABSOLUTEANGLE|WARPF_NOCHECKPOSITION|WARPF_INTERPOLATE)
			TNT1 A 0 A_SetUserVar("user_angle", user_angle + 4)
			Goto Idle
			
		Pain:
			TNT1 A 0 A_PlaySound("weapons/bounc1")
			Goto Idle
			
		Death:
			CUBE F 0 Bright A_Stop
			CUBE F 6 Bright A_Scream
			CUBE G 6 Bright
			CUBE H 6 Bright A_NoBlocking
			CUBE J 6 Bright
			Stop
  }
}

ACTOR SkullCubeShot {
	Radius 5
	Height 5
	Speed 15
	Damage 1
	RenderStyle Add
	Projectile
	Species "Spider"
	+RANDOMIZE
	+THRUSPECIES
	SeeSound "weapons/firsfi"
	DeathSound "weapons/maceex"
	 
	States {
		Spawn:
			CBA2 ABABAB 3 bright
			Loop
			
		Death:
			CBA2 CDEFG 5 bright
			Stop
	}
}

ACTOR MadnessCountdown {
	+NOBLOCKMAP
	+NOGRAVITY
	RenderStyle Add
	Alpha 1
	Scale 0.4
	
	States {
		Spawn:
			CCTD A 1 Bright A_Fire(CallACS("cvar_MoveBob"))
			TNT1 A 0 A_PlaySound("madness/count")
			CCTD ABBAABBAABBAABBAABBAABBCCDDCCDDCCDDCCDDCCDDCCDDEEFFEEFFEEFFEEFFEEFFEEFFGGHHGGHHGGHH 1 Bright A_Fire(CallACS("cvar_MoveBob"))
			TNT1 A 0 A_SpawnItemEx("MadnessNuke",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION)
			TNT1 A 0 A_PlaySound("world/barrelx")
			Stop
	}
}

ACTOR MadnessNuke {
	RenderStyle Add
	Alpha 1
	+NOGRAVITY
	+NOBLOCKMAP
	+RANDOMIZE
	
	States {
		Spawn:
			TNT1 A 0 A_Explode(random(1, 4) * 30, 96)
			HBA3 DE 4 Bright
			TNT1 A 0 A_Explode(random(1, 4) * 20, 128)
			TNT1 A 0 A_SpawnItemEx("MadnessMiniNuke",  80,   0,0,0,0,0,0,SXF_NOCHECKPOSITION)
			TNT1 A 0 A_SpawnItemEx("MadnessMiniNuke", -80,   0,0,0,0,0,0,SXF_NOCHECKPOSITION)
			TNT1 A 0 A_SpawnItemEx("MadnessMiniNuke",   0,  80,0,0,0,0,0,SXF_NOCHECKPOSITION)
			TNT1 A 0 A_SpawnItemEx("MadnessMiniNuke",   0, -80,0,0,0,0,0,SXF_NOCHECKPOSITION)
			TNT1 A 0 A_SpawnItemEx("MadnessMiniNuke",  64,  64,0,0,0,0,0,SXF_NOCHECKPOSITION)
			TNT1 A 0 A_SpawnItemEx("MadnessMiniNuke", -64,  64,0,0,0,0,0,SXF_NOCHECKPOSITION)
			TNT1 A 0 A_SpawnItemEx("MadnessMiniNuke", -64, -64,0,0,0,0,0,SXF_NOCHECKPOSITION)
			TNT1 A 0 A_SpawnItemEx("MadnessMiniNuke",  64, -64,0,0,0,0,0,SXF_NOCHECKPOSITION)
			TNT1 A 0 A_PlaySound("world/barrelx")
			BARL FG 4 Bright
			TNT1 A 0 A_Explode(random(1, 4) * 10, 224)
			TNT1 A 0 A_SpawnItemEx("MadnessMiniNuke", 160,   0,0,0,0,0,0,SXF_NOCHECKPOSITION)
			TNT1 A 0 A_SpawnItemEx("MadnessMiniNuke",-160,   0,0,0,0,0,0,SXF_NOCHECKPOSITION)
			TNT1 A 0 A_SpawnItemEx("MadnessMiniNuke",   0, 160,0,0,0,0,0,SXF_NOCHECKPOSITION)
			TNT1 A 0 A_SpawnItemEx("MadnessMiniNuke",   0,-160,0,0,0,0,0,SXF_NOCHECKPOSITION)
			TNT1 A 0 A_SpawnItemEx("MadnessMiniNuke", 128, 128,0,0,0,0,0,SXF_NOCHECKPOSITION)
			TNT1 A 0 A_SpawnItemEx("MadnessMiniNuke",-128, 128,0,0,0,0,0,SXF_NOCHECKPOSITION)
			TNT1 A 0 A_SpawnItemEx("MadnessMiniNuke",-128,-128,0,0,0,0,0,SXF_NOCHECKPOSITION)
			TNT1 A 0 A_SpawnItemEx("MadnessMiniNuke", 128,-128,0,0,0,0,0,SXF_NOCHECKPOSITION)
			TNT1 A 0 A_PlaySound("world/barrelx")
			BARL HIJKLM 4 Bright
			Stop
  }
}


ACTOR MadnessMiniNuke {
  +NOGRAVITY
  +NOBLOCKMAP
  +RANDOMIZE
  RenderStyle Add
  Alpha 1
  States
  {
  Spawn:
    FBOM ABCDEF 6 BRIGHT
    Stop
  }
}